standard: "PCI-DSS"
description: "Payment Card Industry Data Security Standard (PCI DSS) 4.0 - Expanded Technical Controls"
controls:
  # --- Network & Firewall ---
  - id: "PCI-1.2.1"
    name: "Restrict Inbound and Outbound Traffic"
    description: "Build firewall configurations that restrict traffic."
    check_tool: "script"
    command: "sudo iptables -L -n | grep -E 'DROP|REJECT' || echo 'No restrictions found'"
    remediation: "Configure iptables/ufw to deny unnecessary traffic."

  - id: "PCI-1.3.1"
    name: "Prohibit Direct Public Access"
    description: "Do not allow direct public access between internet and CDE."
    check_tool: "script"
    command: "netstat -rn | grep '0.0.0.0'"
    remediation: "Ensure routing tables deny direct traffic."

  - id: "PCI-2.2.4"
    name: "Remove unnecessary services"
    description: "Disable unused services."
    check_tool: "script"
    command: "systemctl list-units --type=service --state=running | grep -E 'cups|avahi|rpc'"
    remediation: "Disable unused services."

  - id: "PCI-4.1.1"
    name: "Strong Cryptography for Transmission"
    description: "Ensure strong cryptography (TLS 1.2+)."
    check_tool: "nmap"
    command: "nmap --script ssl-enum-ciphers -p 443 localhost"
    remediation: "Disable SSLv3, TLS 1.0, TLS 1.1."

  # --- System Defaults & Auth ---
  - id: "PCI-2.1.1"
    name: "Change Vendor Defaults"
    description: "Ensure default passwords are changed."
    check_tool: "script"
    command: "grep -E '^(lp|sync|shutdown|halt|mail|uucp|operator|games|gopher|ftp):' /etc/shadow | cut -d: -f2 | grep -v '*' | grep -v '!'"
    remediation: "Lock or remove default vendor accounts."

  - id: "PCI-8.2.3"
    name: "Password Complexity"
    description: "Passwords must be at least 12 characters and complex."
    check_tool: "script"
    command: "grep 'minlen' /etc/security/pwquality.conf || grep 'minlen' /etc/pam.d/common-password"
    remediation: "Set minlen=12 or higher in pam_pwquality."

  - id: "PCI-8.2.4"
    name: "Password Expiration"
    description: "User passwords expire every 90 days."
    check_tool: "script"
    command: "grep '^PASS_MAX_DAYS' /etc/login.defs"
    remediation: "Set PASS_MAX_DAYS 90 in /etc/login.defs."

  - id: "PCI-8.2.5"
    name: "Lockout on Failed Attempts"
    description: "Lock account after 10 failed attempts."
    check_tool: "script"
    command: "grep 'pam_tally2' /etc/pam.d/common-auth || grep 'pam_faillock' /etc/pam.d/common-auth"
    remediation: "Configure account locking in PAM."

  # --- Maintenance & Monitoring ---
  - id: "PCI-6.3.3"
    name: "Software Patches"
    description: "Ensure security patches are applied."
    check_tool: "script"
    command: "apt-get -s upgrade | grep '0 upgraded' || echo 'Updates Available'"
    remediation: "Run apt-get update && apt-get upgrade."

  - id: "PCI-10.2.2"
    name: "Audit Log Retention"
    description: "Verify that audit logs are retained."
    check_tool: "script"
    command: "grep '^rotate' /etc/logrotate.conf"
    remediation: "Ensure logs are rotated and kept for at least 1 year."

  - id: "PCI-10.5.5"
    name: "File Integrity Monitoring"
    description: "Use FIM to monitor critical files."
    check_tool: "script"
    command: "dpkg -s aide || dpkg -s tripwire"
    remediation: "Install AIDE or Tripwire."

  - id: "PCI-10.4.1"
    name: "Time Synchronization"
    description: "Use NTP to synchronize time."
    check_tool: "script"
    command: "timedatectl | grep 'NTP service: active'"
    remediation: "Enable systemd-timesyncd or ntp."
